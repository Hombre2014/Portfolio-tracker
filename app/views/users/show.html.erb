  <div class="container">
  <h1 class="text-center my-16 font-bold text-4xl">User profile</h1>
  <div class="w-full mx-auto flex justify-between", style="column-gap: 1rem;">
    <div class="flex flex-col w-1/3">
      <div class="max-w-16">Avatar
        <% if current_user.provider != 'google_oauth2' %>
          <div class="mx-0">
            <div><%= gravatar_for(current_user) %></div>
          </div>
        <% else %>
          <% if current_user.avatar_url %>
            <%= image_tag current_user.avatar_url, style: "max-width: 128px; hight: auto;" %>
          <% end %>
        <% end %>
        <span>Avatar can be changed on <%= link_to "Gravatar", "https://en.gravatar.com/emails/",  target: :'_blank', rel: :'noopener noreferrer', class:"text-dollar-split_blue font-bold hover:text-dollar-complement" %> or <%= link_to "Google", "https://myaccount.google.com/",  target: :'_blank', rel: :'noopener noreferrer', class:"text-dollar-split_blue font-bold hover:text-dollar-complement" %></span>
      </div>
      <span>Name <%= @user.name %></span>
      <span>Email <%= @user.email %></span>
      <%= link_to "Edit you credentials", edit_user_registration_path, class: "mt-12 rounded-lg py-1 px-3 bg-dollar-split_blue inline-block font-medium text-white hover:bg-dollar-triad_blue w-fit" %>
    </div>
    <div class="flex flex-col w-1/3">
      <div>
        <h2>Your top gaining positions</h2>
          <% @position_winners = {} %>
          <% @portfolio_position = {} %>
          <% @position_loosers = {} %>
          <% @winners = 0 %>
          <% @loosers = 0 %>
          <% @stats = {} %>
          <% @positions.each do |position| %>
            <% price = @finnhub_client.quote(position.symbol) %>
            <% position_cost = position.quantity * position.cost_per_share - position.reinvested_income %>
            <% position_value = (position.quantity * price.c).round(2) %>
            <% if (position_value - position_cost >= 0) %>
              <% @winners += 1 %>
              <% @stats.store('amount', position_value - position_cost) %>
              <% @position_winners.store(position.symbol, @stats['amount']) %>
              <% portfolio_name = @portfolios.where(id: position.portfolio_id).pluck(:name)[0] %>
              <% @stats.store('portfolio_name', portfolio_name) %>
              <% @portfolio_position.store(position.symbol, @stats['portfolio_name']) %>
            <% else %>
              <% @loosers += 1 %>
              <% @stats.store('amount', position_value - position_cost) %>
              <% @position_loosers.store(position.symbol, @stats['amount']) %>
              <% portfolio_name = @portfolios.where(id: position.portfolio_id).pluck(:name)[0] %>
              <% @stats.store('portfolio_name', portfolio_name) %>
              <% @portfolio_position.store(position.symbol, @stats['portfolio_name']) %>
            <% end %>
          <% end %>
          <% position_cost = 0 %>
          <% position_value = 0 %>
          <% @position_winners = @position_winners.sort_by {|_key, amount| amount}.reverse.to_h %>
          <% @position_winners = @position_winners.first(3) %>
          <% @position_winners.each do |key, position| %>
            <% if @winners > 0 %>
            <div class="flex", style="column-gap: 1rem;">
              <div class="flex justify-between w-1/3">
                <span><%= key %></span>
                <span class="text-green-600"><%= number_to_currency(position) %></span>
              </div>
              <div>
                <span class="text-600"><%= @portfolio_position[key] %></span>
              </div>
            </div>
            <% else %>
              <%= puts "You don't have any winners" %>
            <% end %>
          <% end %>
      </div>
    </div>
    <div class="flex flex-col w-1/3">
      <div>
        <h2>Your top loosing positions</h2>
        <% @position_loosers = @position_loosers.sort_by {|_key, position| position}.to_h %>
          <% @position_loosers = @position_loosers.first(3) %>
          <% @position_loosers.each do |key, position| %>
            <% if @loosers > 0 %>
              <div class="flex", style="column-gap: 1rem;">
                <div class="flex justify-between w-1/3">
                  <span><%= key %></span>
                  <span class="text-red-600"><%= number_to_currency(position) %></span>
                </div>
                <div>
                  <span class="text-600"><%= @portfolio_position[key] %></span>
                </div>
            </div>
            <% else %>
              <%= puts "You don't have any loosers" %>
            <% end %>
          <% end %> 
      </div>
    </div>
  </div>
</div>
